<!-- Scikit-Nano Analysis -->
<div id="sknano-container" class="container" style="display: none;">
    <div class="controls">
        <form id="sknano-form">
            <div class="form-group">
                <label>Structure Type:</label>
                <select id="structure-type" onchange="updateStructureParams()">
                    <option value="nanotube">Carbon Nanotube</option>
                    <option value="graphene">Graphene Sheet</option>
                </select>
            </div>

            <!-- Nanotube Parameters -->
            <div id="nanotube-params">
                <div class="form-group">
                    <label>Chiral Index n:</label>
                    <input type="number" id="nanotube-n" value="6" min="1" max="20" step="1">
                </div>
                <div class="form-group">
                    <label>Chiral Index m:</label>
                    <input type="number" id="nanotube-m" value="0" min="0" max="20" step="1">
                </div>
                <div class="form-group">
                    <label>Length (nm):</label>
                    <input type="number" id="nanotube-length" value="10.0" min="1.0" max="100.0" step="1.0">
                </div>
                <div class="form-group">
                    <label>Basis Element:</label>
                    <select id="nanotube-basis">
                        <option value="C">Carbon</option>
                        <option value="B">Boron</option>
                        <option value="N">Nitrogen</option>
                        <option value="BN">Boron Nitride</option>
                    </select>
                </div>
            </div>

            <!-- Graphene Parameters -->
            <div id="graphene-params" style="display: none;">
                <div class="form-group">
                    <label>Width (nm):</label>
                    <input type="number" id="graphene-width" value="10.0" min="1.0" max="100.0" step="1.0">
                </div>
                <div class="form-group">
                    <label>Length (nm):</label>
                    <input type="number" id="graphene-length" value="10.0" min="1.0" max="100.0" step="1.0">
                </div>
                <div class="form-group">
                    <label>Edge Type:</label>
                    <select id="graphene-edge">
                        <option value="armchair">Armchair</option>
                        <option value="zigzag">Zigzag</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Basis Element:</label>
                    <select id="graphene-basis">
                        <option value="C">Carbon</option>
                        <option value="B">Boron</option>
                        <option value="N">Nitrogen</option>
                        <option value="BN">Boron Nitride</option>
                    </select>
                </div>
            </div>

            <!-- Analysis Options -->
            <div class="form-group">
                <label>Analysis Type:</label>
                <select id="analysis-type">
                    <option value="structure">Structure</option>
                    <option value="bonds">Bond Analysis</option>
                    <option value="defects">Defect Analysis</option>
                </select>
            </div>

            <button type="submit">Run Analysis</button>
        </form>
    </div>
    <div id="sknano-plot" class="plot"></div>
</div>

<script>
function updateStructureParams() {
    const structType = document.getElementById('structure-type').value;
    
    // Hide all parameter sections
    document.getElementById('nanotube-params').style.display = 'none';
    document.getElementById('graphene-params').style.display = 'none';
    
    // Show selected parameter section
    if (structType === 'nanotube') {
        document.getElementById('nanotube-params').style.display = 'block';
    } else if (structType === 'graphene') {
        document.getElementById('graphene-params').style.display = 'block';
    }
}

document.getElementById('sknano-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const structType = document.getElementById('structure-type').value;
    let data = {
        structure_type: structType,
        analysis_type: document.getElementById('analysis-type').value
    };
    
    // Get parameters based on structure type
    if (structType === 'nanotube') {
        data = {
            ...data,
            n: parseInt(document.getElementById('nanotube-n').value),
            m: parseInt(document.getElementById('nanotube-m').value),
            length: parseFloat(document.getElementById('nanotube-length').value),
            basis: document.getElementById('nanotube-basis').value
        };
    } else if (structType === 'graphene') {
        data = {
            ...data,
            width: parseFloat(document.getElementById('graphene-width').value),
            length: parseFloat(document.getElementById('graphene-length').value),
            edge_type: document.getElementById('graphene-edge').value,
            basis: document.getElementById('graphene-basis').value
        };
    }

    try {
        const response = await fetch('/sknano', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        const result = await response.json();
        if (result.error) {
            console.error('Scikit-Nano analysis error:', result.error);
            return;
        }
        const plotData = JSON.parse(result.plot);
        Plotly.newPlot('sknano-plot', plotData.data, plotData.layout);
    } catch (error) {
        console.error('Error running Scikit-Nano analysis:', error);
    }
});

// Initialize parameter visibility
updateStructureParams();</script> 