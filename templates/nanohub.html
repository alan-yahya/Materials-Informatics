<!-- NanoHUB Simulation -->
<div id="nanohub-container" class="container" style="display: none;">
    <div class="controls">
        <form id="nanohub-form">
            <div class="form-group">
                <label>Simulation Type:</label>
                <select id="simulation-type" onchange="updateSimulationParams()">
                    <option value="qdot">Quantum Dot</option>
                    <option value="cnt">Carbon Nanotube</option>
                </select>
            </div>

            <!-- Quantum Dot Parameters -->
            <div id="qdot-params">
                <div class="form-group">
                    <label>Radius (nm):</label>
                    <input type="number" id="qdot-radius" value="5.0" min="1.0" max="20.0" step="0.5">
                </div>
                <div class="form-group">
                    <label>Material:</label>
                    <select id="qdot-material">
                        <option value="CdSe">CdSe</option>
                        <option value="CdS">CdS</option>
                        <option value="InAs">InAs</option>
                        <option value="GaAs">GaAs</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Temperature (K):</label>
                    <input type="number" id="qdot-temperature" value="300" min="0" max="1000" step="10">
                </div>
                <div class="form-group">
                    <label>Max Principal Number (n):</label>
                    <input type="number" id="qdot-max-n" value="3" min="1" max="5" step="1">
                </div>
                <div class="form-group">
                    <label>Max Angular Momentum (l):</label>
                    <input type="number" id="qdot-max-l" value="2" min="0" max="4" step="1">
                </div>
            </div>

            <!-- Carbon Nanotube Parameters -->
            <div id="cnt-params" style="display: none;">
                <div class="form-group">
                    <label>Chiral Index n:</label>
                    <input type="number" id="cnt-n" value="6" min="1" max="20" step="1">
                </div>
                <div class="form-group">
                    <label>Chiral Index m:</label>
                    <input type="number" id="cnt-m" value="0" min="0" max="20" step="1">
                </div>
                <div class="form-group">
                    <label>Length (nm):</label>
                    <input type="number" id="cnt-length" value="10.0" min="1.0" max="100.0" step="1.0">
                </div>
                <div class="form-group">
                    <label>Number of k-points:</label>
                    <input type="number" id="cnt-kpoints" value="100" min="10" max="500" step="10">
                </div>
            </div>

            <button type="submit">Run Simulation</button>
        </form>
    </div>
    <div id="nanohub-plot" class="plot"></div>
</div>

<script>
function updateSimulationParams() {
    const simType = document.getElementById('simulation-type').value;
    
    // Hide all parameter sections
    document.getElementById('qdot-params').style.display = 'none';
    document.getElementById('cnt-params').style.display = 'none';
    
    // Show selected parameter section
    if (simType === 'qdot') {
        document.getElementById('qdot-params').style.display = 'block';
    } else if (simType === 'cnt') {
        document.getElementById('cnt-params').style.display = 'block';
    }
}

document.getElementById('nanohub-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const simType = document.getElementById('simulation-type').value;
    let data = {
        simulation_type: simType
    };
    
    // Get parameters based on simulation type
    if (simType === 'qdot') {
        data = {
            ...data,
            radius: parseFloat(document.getElementById('qdot-radius').value),
            material: document.getElementById('qdot-material').value,
            temperature: parseFloat(document.getElementById('qdot-temperature').value),
            max_n: parseInt(document.getElementById('qdot-max-n').value),
            max_l: parseInt(document.getElementById('qdot-max-l').value)
        };
    } else if (simType === 'cnt') {
        data = {
            ...data,
            n: parseInt(document.getElementById('cnt-n').value),
            m: parseInt(document.getElementById('cnt-m').value),
            length: parseFloat(document.getElementById('cnt-length').value),
            k_points: parseInt(document.getElementById('cnt-kpoints').value)
        };
    }

    try {
        const response = await fetch('/nanohub', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        const result = await response.json();
        if (result.error) {
            console.error('NanoHUB simulation error:', result.error);
            return;
        }
        const plotData = JSON.parse(result.plot);
        Plotly.newPlot('nanohub-plot', plotData.data, plotData.layout);
    } catch (error) {
        console.error('Error running NanoHUB simulation:', error);
    }
});

// Initialize parameter visibility
updateSimulationParams();</script> 